# ğŸ—ºï¸ System Architecture Diagram

**Webma EarthGuard - Environmental Monitoring System**

---

## ğŸ“Š High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND (React)                         â”‚
â”‚                     http://localhost:5173                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   MapContainerâ”‚  â”‚  LayerToggle â”‚  â”‚ EnvironmentalDataPanelâ”‚  â”‚
â”‚  â”‚   (Leaflet)  â”‚  â”‚              â”‚  â”‚                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   InfoPanel  â”‚  â”‚  AlertsBar   â”‚  â”‚      TopNav          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ HTTP/REST
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND API (Express)                         â”‚
â”‚                   http://localhost:8080/api                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ROUTES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  /health          /fires           /air/points            â”‚  â”‚
â”‚  â”‚  /weather         /risk            /alerts                â”‚  â”‚
â”‚  â”‚  /vegetation      /flood           /fire-risk       âœ¨NEW â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ SERVICES â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  openmeteo.ts    openaq.ts       firms.ts                â”‚  â”‚
â”‚  â”‚  waqi.ts âœ¨      vegetation.ts âœ¨  flood.ts âœ¨            â”‚  â”‚
â”‚  â”‚  fire-risk.ts âœ¨                                          â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  cache.ts        bbox.ts         risk.ts                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚ External APIs
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      EXTERNAL DATA SOURCES                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Open-Meteo  â”‚  â”‚    OpenAQ    â”‚  â”‚    NASA FIRMS        â”‚  â”‚
â”‚  â”‚  (Weather)   â”‚  â”‚ (Air Quality)â”‚  â”‚    (Fires)           â”‚  â”‚
â”‚  â”‚  âœ… No Key   â”‚  â”‚  âœ… No Key   â”‚  â”‚    ğŸ”‘ Key Required   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚    WAQI      â”‚  â”‚  NASA GIBS   â”‚  â”‚   Copernicus DEM     â”‚  â”‚
â”‚  â”‚(Air Quality) â”‚  â”‚  (NDVI Tiles)â”‚  â”‚   (Elevation)        â”‚  â”‚
â”‚  â”‚ğŸ”‘ Key Requiredâ”‚  â”‚  âœ… No Key   â”‚  â”‚   âœ… No Key          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Sentinel-2  â”‚  â”‚  Sentinel-5P â”‚  â”‚   NASA GPM           â”‚  â”‚
â”‚  â”‚   (NDVI)     â”‚  â”‚  (COâ‚‚, NOâ‚‚)  â”‚  â”‚  (Precipitation)     â”‚  â”‚
â”‚  â”‚ğŸ“‹ Optional   â”‚  â”‚  ğŸ“‹ Optional â”‚  â”‚   âœ… No Key          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Data Flow Diagram

### User Clicks on Map

```
User clicks map location (lat, lon)
         â”‚
         â–¼
Frontend sends parallel requests:
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼         â–¼        â–¼          â–¼          â–¼
/vegetation /flood  /fire-risk /weather   /air/points
    â”‚         â”‚        â”‚          â”‚          â”‚
    â–¼         â–¼        â–¼          â–¼          â–¼
Backend services fetch/calculate data
    â”‚         â”‚        â”‚          â”‚          â”‚
    â–¼         â–¼        â–¼          â–¼          â–¼
Check cache (10min - 1hr TTL)
    â”‚         â”‚        â”‚          â”‚          â”‚
    â–¼         â–¼        â–¼          â–¼          â–¼
If not cached, fetch from external APIs
    â”‚         â”‚        â”‚          â”‚          â”‚
    â–¼         â–¼        â–¼          â–¼          â–¼
Process & calculate risk scores
    â”‚         â”‚        â”‚          â”‚          â”‚
    â–¼         â–¼        â–¼          â–¼          â–¼
Return JSON responses
    â”‚         â”‚        â”‚          â”‚          â”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â–¼
Frontend displays in InfoPanel/EnvironmentalDataPanel
         â”‚
         â–¼
User sees: NDVI, Oâ‚‚, Flood Risk, Fire Risk, Recommendations
```

---

## ğŸŒ¿ Vegetation Service Flow

```
GET /api/vegetation?lat=30.4278&lon=-9.5981
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  vegetation.ts                 â”‚
â”‚                                â”‚
â”‚  1. Check cache (1hr TTL)      â”‚
â”‚  2. Calculate NDVI             â”‚
â”‚     (mock or Sentinel-2)       â”‚
â”‚  3. Estimate Oâ‚‚ from NDVI      â”‚
â”‚  4. Determine vegetation level â”‚
â”‚  5. Check tree recommendation  â”‚
â”‚  6. Return color code          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Response:
{
  "ndvi": 0.35,
  "vegetationLevel": "Moderate Vegetation",
  "o2Estimate": 82,
  "treeRecommendation": false,
  "color": "#ffffbf"
}
```

---

## ğŸ’§ Flood Prediction Flow

```
GET /api/flood?lat=30.4278&lon=-9.5981
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  flood.ts                      â”‚
â”‚                                â”‚
â”‚  1. Get weather forecast       â”‚
â”‚     (rainfall next 3 days)     â”‚
â”‚  2. Get elevation (DEM)        â”‚
â”‚  3. Calculate slope            â”‚
â”‚  4. Calculate soil saturation  â”‚
â”‚  5. Compute flood probability  â”‚
â”‚     - Rainfall: 0-40 points    â”‚
â”‚     - Elevation: 0-30 points   â”‚
â”‚     - Slope: 0-15 points       â”‚
â”‚     - Saturation: 0-15 points  â”‚
â”‚  6. Generate predictions       â”‚
â”‚  7. Create recommendations     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Response:
{
  "riskLevel": "Medium",
  "probability": 45,
  "prediction": {
    "next24h": "Moderate risk",
    "next48h": "Moderate risk",
    "next72h": "Low risk"
  },
  "recommendations": [...]
}
```

---

## ğŸ”¥ Fire Risk Assessment Flow

```
GET /api/fire-risk?lat=30.4278&lon=-9.5981
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  fire-risk.ts                  â”‚
â”‚                                â”‚
â”‚  1. Get weather data           â”‚
â”‚     - Temperature              â”‚
â”‚     - Humidity                 â”‚
â”‚     - Wind speed               â”‚
â”‚  2. Get vegetation (NDVI)      â”‚
â”‚  3. Calculate fire probability â”‚
â”‚     - Temperature: 0-30 points â”‚
â”‚     - Humidity: 0-30 points    â”‚
â”‚     - Wind: 0-25 points        â”‚
â”‚     - NDVI dryness: 0-15 pts   â”‚
â”‚  4. Determine risk level       â”‚
â”‚  5. Calculate fire spread      â”‚
â”‚     - Speed from wind          â”‚
â”‚     - Direction from wind      â”‚
â”‚  6. Generate recommendations   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
Response:
{
  "riskLevel": "Medium",
  "probability": 42,
  "spread": {
    "speed": 4.5,
    "direction": 0,
    "description": "Moderate spread rate"
  },
  "recommendations": [...]
}
```

---

## ğŸ—ºï¸ Map Layers Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Leaflet Map Container                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Base Layer (OpenStreetMap)                                  â”‚
â”‚  â”œâ”€â”€ Street view                                             â”‚
â”‚  â”œâ”€â”€ Satellite view                                          â”‚
â”‚  â””â”€â”€ Terrain view                                            â”‚
â”‚                                                               â”‚
â”‚  Overlay Layers (Toggle on/off)                              â”‚
â”‚  â”œâ”€â”€ ğŸŒ¿ Vegetation (NDVI)                                    â”‚
â”‚  â”‚   â””â”€â”€ NASA GIBS MODIS NDVI tiles                         â”‚
â”‚  â”‚                                                            â”‚
â”‚  â”œâ”€â”€ ğŸ’§ Flood Risk                                           â”‚
â”‚  â”‚   â””â”€â”€ NASA GPM Precipitation tiles + calculated overlay  â”‚
â”‚  â”‚                                                            â”‚
â”‚  â”œâ”€â”€ ğŸ”¥ Fire Risk                                            â”‚
â”‚  â”‚   â”œâ”€â”€ NASA FIRMS active fire points                      â”‚
â”‚  â”‚   â””â”€â”€ Calculated risk heatmap                            â”‚
â”‚  â”‚                                                            â”‚
â”‚  â”œâ”€â”€ ğŸ’¨ Air Quality                                          â”‚
â”‚  â”‚   â”œâ”€â”€ WAQI/OpenAQ sensor points                          â”‚
â”‚  â”‚   â””â”€â”€ AQI heatmap                                         â”‚
â”‚  â”‚                                                            â”‚
â”‚  â””â”€â”€ ğŸŒ¡ï¸ Temperature                                          â”‚
â”‚      â””â”€â”€ MODIS Land Surface Temperature tiles               â”‚
â”‚                                                               â”‚
â”‚  Interactive Elements                                         â”‚
â”‚  â”œâ”€â”€ Click â†’ Show InfoPanel with all data                   â”‚
â”‚  â”œâ”€â”€ Hover â†’ Quick tooltip                                   â”‚
â”‚  â””â”€â”€ Legend â†’ Color scale explanation                        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ Caching Strategy

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Cache Layer                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  In-Memory Cache (utils/cache.ts)                           â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Key Format: "service:params"                        â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â”‚  vegetation:30.43,-9.60    â†’ TTL: 1 hour            â”‚   â”‚
â”‚  â”‚  flood:30.43,-9.60         â†’ TTL: 10 minutes        â”‚   â”‚
â”‚  â”‚  fire-risk:30.43,-9.60     â†’ TTL: 10 minutes        â”‚   â”‚
â”‚  â”‚  weather:30.43,-9.60       â†’ TTL: 10 minutes        â”‚   â”‚
â”‚  â”‚  openaq:-10,30,-9,31       â†’ TTL: 10 minutes        â”‚   â”‚
â”‚  â”‚  firms:-10,30,-9,31        â†’ TTL: 1 hour            â”‚   â”‚
â”‚  â”‚                                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                               â”‚
â”‚  Cache Hit â†’ Return immediately (< 1ms)                     â”‚
â”‚  Cache Miss â†’ Fetch from API â†’ Store â†’ Return (200-500ms)  â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ” Security Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Security Layers                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Frontend (Public)                                           â”‚
â”‚  â”œâ”€â”€ No API keys exposed                                     â”‚
â”‚  â”œâ”€â”€ CORS: Only from allowed origins                         â”‚
â”‚  â””â”€â”€ Environment: VITE_API_BASE only                         â”‚
â”‚                                                               â”‚
â”‚  Backend (Private)                                           â”‚
â”‚  â”œâ”€â”€ API keys in .env (not committed)                        â”‚
â”‚  â”œâ”€â”€ CORS middleware (express-cors)                          â”‚
â”‚  â”œâ”€â”€ Input validation (lat/lon ranges)                       â”‚
â”‚  â””â”€â”€ Error handling (no sensitive data in errors)            â”‚
â”‚                                                               â”‚
â”‚  External APIs                                               â”‚
â”‚  â”œâ”€â”€ Keys stored in environment variables                    â”‚
â”‚  â”œâ”€â”€ Rate limiting handled by cache                          â”‚
â”‚  â””â”€â”€ Fallback to mock data on failure                        â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Data Processing Pipeline

```
External API Response
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Raw Data           â”‚
â”‚  (JSON/CSV/Tiles)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Parse & Validate   â”‚
â”‚  - Check format     â”‚
â”‚  - Validate values  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Transform          â”‚
â”‚  - Calculate NDVI   â”‚
â”‚  - Compute risks    â”‚
â”‚  - Generate colors  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Enrich             â”‚
â”‚  - Add metadata     â”‚
â”‚  - Add timestamps   â”‚
â”‚  - Add location     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Cache              â”‚
â”‚  - Store in memory  â”‚
â”‚  - Set TTL          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Return to Client   â”‚
â”‚  - JSON response    â”‚
â”‚  - HTTP 200         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Request/Response Examples

### Example 1: Get Environmental Data

```
REQUEST:
GET http://localhost:8080/api/vegetation?lat=30.4278&lon=-9.5981

PROCESSING:
1. Parse lat/lon
2. Check cache (key: "vegetation:30.43,-9.60")
3. If miss: Calculate NDVI based on location
4. Estimate Oâ‚‚ from NDVI
5. Determine vegetation level
6. Check tree recommendation
7. Cache result (1 hour)
8. Return JSON

RESPONSE:
{
  "ndvi": 0.35,
  "vegetationLevel": "Moderate Vegetation",
  "o2Estimate": 82,
  "treeRecommendation": false,
  "color": "#ffffbf"
}
```

### Example 2: Get Comprehensive Risk

```
REQUEST:
GET http://localhost:8080/api/risk?lat=30.4278&lon=-9.5981

PROCESSING:
1. Parallel fetch:
   - Weather (Open-Meteo)
   - Air quality (OpenAQ/WAQI)
   - Fires (NASA FIRMS)
2. Calculate risks:
   - Flood risk from rainfall
   - Fire risk from weather + vegetation
   - Heat risk from temperature
   - Air quality risk from PM2.5
3. Generate AI suggestions
4. Return combined analysis

RESPONSE:
{
  "floodRisk": "Medium (30-60mm rainfall expected)",
  "fireRisk": "Low (humidity 67%)",
  "heatRisk": "34Â°C, Medium risk",
  "airQualityRisk": "Moderate (PM2.5: 43 Âµg/mÂ³)",
  "o2Estimate": "80% of normal",
  "suggestions": [
    "Prepare sandbags in low-lying areas",
    "Install reflective coatings on roofs",
    "Increase vegetation along boulevards"
  ]
}
```

---

## ğŸš€ Deployment Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Production Setup                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  Frontend (Vercel)                                           â”‚
â”‚  â”œâ”€â”€ Domain: earthguard.vercel.app                          â”‚
â”‚  â”œâ”€â”€ CDN: Global edge network                               â”‚
â”‚  â”œâ”€â”€ Build: npm run build                                    â”‚
â”‚  â””â”€â”€ Env: VITE_API_BASE=https://api.earthguard.com         â”‚
â”‚                                                               â”‚
â”‚  Backend (Render/Railway)                                    â”‚
â”‚  â”œâ”€â”€ Domain: api.earthguard.com                             â”‚
â”‚  â”œâ”€â”€ Build: npm run build                                    â”‚
â”‚  â”œâ”€â”€ Start: npm start                                        â”‚
â”‚  â””â”€â”€ Env: All API keys + CORS_ORIGIN                        â”‚
â”‚                                                               â”‚
â”‚  Database (Future)                                           â”‚
â”‚  â”œâ”€â”€ PostgreSQL + PostGIS                                    â”‚
â”‚  â”œâ”€â”€ Store: Historical data, user prefs                     â”‚
â”‚  â””â”€â”€ Cache: Redis for distributed caching                   â”‚
â”‚                                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ˆ Scalability Considerations

```
Current (MVP):
- In-memory cache
- Single server
- ~100 requests/minute

Future (Production):
- Redis distributed cache
- Load balancer
- Multiple server instances
- CDN for static assets
- Database for persistence
- ~10,000 requests/minute
```

---

**This diagram shows the complete system architecture for Webma EarthGuard!** ğŸŒ
